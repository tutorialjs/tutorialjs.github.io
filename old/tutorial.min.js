"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},_createClass=(function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}})();!(function(t,e,n){var s=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}},{key:"easeOutQuad",value:function(t,e,n,s){return-n*(t/=s)*(t-2)+e}},{key:"checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"getElementBounds",value:function(t){return{top:t.offsetTop,left:t.offsetLeft,bottom:t.offsetTop+t.offsetHeight,width:t.offsetWidth,height:t.offsetHeight}}}]),t})(),i=function t(e,n,s){_classCallCheck(this,t),this.node=n,Object.keys(s).length||"function"==typeof s?s.once?this.callback=function(){this.run||(s.fn.call(this,e),this.run=!0)}:this.callback=(s.fn||s).bind(this,e):this.callback=function(){}},o=(function(t){function e(t,s,i){var o=arguments.length>3&&arguments[3]!==n?arguments[3]:{},r=o.title,a=r===n?"":r,l=o.callback,h=l===n?{}:l;_classCallCheck(this,e);var c=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,h));return c.type="normal",c.text=i,c.title=a,c}return _inherits(e,i),e})(),r=(function(t){function s(t,i,o){var r=(arguments.length>3&&arguments[3]!==n?arguments[3]:{}).callback,a=r===n?{}:r;_classCallCheck(this,s);var l=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,i,a));return l.type="advanced",l.template=e.getElementById(o.substr(1)).childNodes[0].data,l}return _inherits(s,i),s})(),a=(function(){function i(){var a=this,l=arguments.length>0&&arguments[0]!==n?arguments[0]:s.mandatory("Name"),h=arguments[1],c=h.selector,p=c===n?"tut-action":c,u=h.steps,d=u===n?[]:u,m=h.persistent,f=m!==n&&m,g=h.buttons,v=g===n?{}:g,y=h.padding,_=y===n?{}:y,b=h.debug,x=b!==n&&b,C=h.autoplay,B=C!==n&&C,k=h.scrollSpeed,E=k===n?800:k,L=h.animate,w=L===n||L,S=h.progressbar,T=S!==n&&S;if(_classCallCheck(this,i),this.elems=[],d.length>0){var H=!0,P=!1,A=n;try{for(var O,N=d[Symbol.iterator]();!(H=(O=N.next()).done);H=!0){var j=O.value,I=e.querySelector(j.highlight);if(!I)throw new Error("Selector "+j.highlight+" not found.");if(j.hasOwnProperty("action")){var z=new r(this,I,j.action.template);z.template=this._parseAdvancedStep(z),z.template.classList.add("custom-box"),this.elems.push(z)}else this.elems.push(new o(this,I,j.text,{title:j.title,callback:j.callback}))}}catch(t){P=!0,A=t}finally{try{!H&&N.return&&N.return()}finally{if(P)throw A}}}else{var q=Array.from(e.getElementsByClassName(p));if(!q.every((function(t){return t.getAttribute("t-step")}))||!q.every((function(t){return t.getAttribute("t-text")})))throw new Error("Not all steps or texts defined");q.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))})),this.elems=q.map((function(t){return new o(a,t,t.getAttribute("t-text"),{title:t.getAttribute("t-title")})}))}if(0===this.elems.length)throw new Error("No activities point defined");this.name=l,this.buttonText={},this.options={selector:p,persistent:f,advancedStorage:s.checkStorageSupport(),scrolling:{speed:E,timer:null,position:0},padding:{top:_.top===n?12:v.close,left:_.left===n?12:v.close},buttons:{previous:v.previous===n?"Back":v.previous,next:v.next===n?"Next":v.next},animate:w,debug:x};var M=this._getCurrentPosition()||0;this.state={running:!1,completed:-1===M,animation:!1,transform:{translateY:0,translateX:0},type:this.elems[0].type,_firstStep:parseInt(this.options.persistent?M:0)},this.components={_step:parseInt(this.options.persistent?M:0),_eventHandler:{load:this.__load(),resize:this.__resize()},_elements:_extends({progressBar:!!T&&this._createProgressbar(),blur:this._createBlurElement()},this._createTutorialBox())},this.components._elements.highlightBox=this._createHighlightBox(this.components._elements.tutorialBox),Object.defineProperty(this,"step",{get:function(){return a.components._step},set:function(t){a.state.running&&(a.animating||(t<0&&a.close(),t===a.elems.length?(a.close(),a.components._step=-1):(a.elems[a.components._step].node.classList.remove("tutorial-highlight"),a.components._step=t,a.elems[t].node.classList.add("tutorial-highlight"),a._updateTutorialBox(),a._updateProgressBar(),a._moveHighlightBox()),a.options.persistent&&a._saveCurrentPosition()))}}),B&&t.addEventListener("load",this.components._eventHandler.load)}return _createClass(i,[{key:"start",value:function(){this.options.debug,this.state.running||-1===this.step||(this.elems[this.step].node.classList.add("tutorial-highlight"),e.body.appendChild(this.components._elements.blur),e.body.appendChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.appendChild(this.components._elements.progressBar),this._moveHighlightBox(),this._updateTutorialBox(),this._updateProgressBar(),this.state.running=!0,t.addEventListener("resize",this.components._eventHandler.resize))}},{key:"close",value:function(){this.state.running&&(this.state.running=!1,this.elems[this.step].node.classList.remove("tutorial-highlight"),this.components._elements.highlightBox.style.transform="",this.components._elements.highlightBox.firstChild.style.transform="",e.body.removeChild(this.components._elements.blur),e.body.removeChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.removeChild(this.components._elements.progressBar),t.removeEventListener("resize",this.components._eventHandler.resize))}},{key:"prev",value:function(){this.step--,this.options.debug}},{key:"next",value:function(){this.elems[this.step].callback(),this.step++,this.options.debug}},{key:"goToStep",value:function(t){if(this.state.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.step=t)}}},{key:"reset",value:function(){this.components._step=0,this.state._firstStep=0,this.state.transform.translateX=0,this.state.transform.translateY=0}},{key:"_parseAdvancedStep",value:function(s){var o=this,r=e.createElement("div"),a=i.actions.baseAttributes,l=i.actions.custom;r.insertAdjacentHTML("afterbegin",s.template);var h=!0,c=!1,p=n;try{for(var u,d=r.getElementsByTagName("*")[Symbol.iterator]();!(h=(u=d.next()).done);h=!0){var m=u.value,f=!0,g=!1,v=n;try{for(var y,_=Object.entries(a)[Symbol.iterator]();!(f=(y=_.next()).done);f=!0)!(function(){var t=y.value;Array.from(m.attributes).some((function(e){return e.name.includes(t[0])}))&&m.addEventListener("click",(function(){t[1].call(o)}))})()}catch(t){g=!0,v=t}finally{try{!f&&_.return&&_.return()}finally{if(g)throw v}}var b=!0,x=!1,C=n;try{for(var B,k=l[Symbol.iterator]();!(b=(B=k.next()).done);b=!0){var E=B.value,L=!0,w=!1,S=n;try{for(var T,H=Array.from(m.attributes)[Symbol.iterator]();!(L=(T=H.next()).done);L=!0)!(function(){var e=T.value;e.name.includes(E.key)&&m.addEventListener(E.event,(function(){t[e.value]()}))})()}catch(t){w=!0,S=t}finally{try{!L&&H.return&&H.return()}finally{if(w)throw S}}}}catch(t){x=!0,C=t}finally{try{!b&&k.return&&k.return()}finally{if(x)throw C}}}}catch(t){c=!0,p=t}finally{try{!h&&d.return&&d.return()}finally{if(c)throw p}}return r}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,n=e.createElement("div");return n.classList.add("tutorial-blur"),n.addEventListener("click",(function(e){t.close()})),n}},{key:"_createHighlightBox",value:function(t){var n=e.createElement("div"),s=n.cloneNode(),i=e.createElement("i");return n.classList.add("tutorial-wrapper"),s.classList.add("tutorial-background"),i.classList.add("tutorial-index"),n.addEventListener("click",(function(t){t.stopPropagation()})),n.appendChild(s),n.appendChild(i),n.appendChild(t),n}},{key:"_createTutorialBox",value:function(){var t=this,n=e.createElement("div"),s=n.cloneNode(!1),i=e.createElement("p"),o=e.createElement("p"),r=o.cloneNode(),a=n.cloneNode(!1),l=n.cloneNode(!1),h=e.createElement("a");h.href="#";var c=h.cloneNode(!1),p=h.cloneNode(!1);return n.classList.add("tutorial-box"),s.classList.add("tutorial-box-wrapper"),i.classList.add("tutorial-title"),o.classList.add("tutorial-description"),r.classList.add("tutorial-step-position"),a.classList.add("tutorial-buttons"),p.classList.add("tutorial-close"),h.textContent=this.options.buttons.previous,c.textContent=this.options.buttons.next,p.addEventListener("click",(function(e){t.close()}),!1),h.addEventListener("click",(function(e){t.prev()}),!1),c.addEventListener("click",(function(e){t.next()}),!1),Object.defineProperties(this.buttonText,{next:{get:function(){return t.options.buttons.next},set:function(e){t.options.buttons.next=e,c.textContent=e}},prev:{get:function(){return t.options.buttons.previous},set:function(e){t.options.buttons.previous=e,h.textContent=e}}}),a.appendChild(r),a.appendChild(p),a.appendChild(l),l.appendChild(h),l.appendChild(c),s.appendChild(i),s.appendChild(o),s.appendChild(a),n.appendChild(s),{tutorialBox:n,tutorialWrapper:s,tutorialTitle:i,tutorialText:o,tutorialPosition:r,tutorialButtonNext:c,tutorialButtonPrev:h}}},{key:"_createProgressbar",value:function(){var t=this,n=e.createElement("div"),s=e.createElement("ul"),i=e.createElement("div"),o=e.createElement("span");n.classList.add("progressbar-wrapper"),i.classList.add("progressbar-track");for(var r=[],a=0;a<=this.elems.length-1;a++){var l=e.createElement("li"),h=e.createElement("span");h.textContent=a+1,l.appendChild(h),l.style.left=100/(this.elems.length-1)*a+"%",s.appendChild(l),r.push(l),l.addEventListener("click",(function(e){t.goToStep(e.target.textContent-1)}),!1)}return i.appendChild(o),n.appendChild(i),n.appendChild(s),n}},{key:"_updateProgressBar",value:function(){if(this.components._elements.progressBar){var t=Array.from(this.components._elements.progressBar.getElementsByTagName("li"));this.components._elements.progressBar.childNodes[0].childNodes[0].style.width=100/(this.elems.length-1)*this.step+"%";for(var e=0;e<=this.elems.length-1;e++)t[e].classList.remove("active","finished");var s=!0,i=!1,o=n;try{for(var r,a=t.slice(0,this.step)[Symbol.iterator]();!(s=(r=a.next()).done);s=!0)r.value.classList.add("finished")}catch(t){i=!0,o=t}finally{try{!s&&a.return&&a.return()}finally{if(i)throw o}}t[this.step].classList.add("active")}}},{key:"_moveHighlightBox",value:function(){var e=this;if(this.state.running&&this.options.animate)this.state.animating=!0,t.requestAnimationFrame(this._animateHighlightBox.bind(this));else{var n=s.getElementBounds(this.elems[this.step].node);this.components._elements.highlightBox.style.top=n.top-this.options.padding.top,this.components._elements.highlightBox.style.left=n.left-this.options.padding.left,this.components._elements.highlightBox.firstChild.style.height=n.bottom-n.top+2*this.options.padding.top,this.components._elements.highlightBox.firstChild.style.width=n.width+2*this.options.padding.left,this.components._elements.tutorialBox.style.top=n.height+2*this.options.padding.top+6+"px",t.requestAnimationFrame((function(){t.scrollTo(0,n.top-(t.innerHeight-(e.components._elements.tutorialBox.offsetHeight+e.components._elements.highlightBox.firstChild.offsetHeight))/2)}))}this.components._elements.highlightBox.childNodes[1].textContent=this.step+1}},{key:"_animateHighlightBox",value:function(){var t=this,e=this.elems[this.state._firstStep].node,n=this.elems[this.step].node;this.state.transform.translateY=n.offsetTop-e.offsetTop,this.state.transform.translateX=n.offsetLeft-e.offsetLeft,this.components._elements.tutorialBox.style.top=n.offsetHeight+2*this.options.padding.top+6+"px",this.components._elements.highlightBox.style.transform="translateX("+this.state.transform.translateX+"px) translateY("+this.state.transform.translateY+"px)",this.components._elements.highlightBox.firstChild.style.width=n.offsetWidth+2*this.options.padding.top,this.components._elements.highlightBox.firstChild.style.height=n.offsetHeight+2*this.options.padding.top,this._scroll(),this.components._elements.highlightBox.addEventListener("transitionend",(function(){t.state.animating=!1}))}},{key:"_updateTutorialBox",value:function(){"normal"===this.elems[this.step].type?("advanced"===this.state.type&&(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.components._elements.tutorialWrapper)),this.components._elements.tutorialText.textContent=this.elems[this.step].text,this.components._elements.tutorialTitle.textContent=this.elems[this.step].title):(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.elems[this.step].template)),this.state.type=this.elems[this.step].type}},{key:"_saveCurrentPosition",value:function(){this.options.advancedStorage?t.localStorage.setItem("tutorial-"+this.name,this.components._step):e.cookie+="tutorial-"+this.name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var n=this;return this.options.advancedStorage?t.localStorage.getItem("tutorial-"+this.name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+n.name)})).map((function(t){return parseInt(t.replace("tutorial-"+n.name+"=",""))}))}},{key:"_scroll",value:function(){var e=this,n=this.elems[this.step].node.offsetTop-(t.innerHeight-(this.components._elements.tutorialBox.offsetHeight+this.components._elements.highlightBox.firstChild.offsetHeight))/2;t.requestAnimationFrame((function(t){e.options.scrolling.timer=t,e.__scrollMovement(t,n)}))}},{key:"__load",value:function(){return function(){t.removeEventListener("load",this.components._eventHandler.load),this.start()}.bind(this)}},{key:"__resize",value:function(){return function(){this.components._elements.highlightBox.classList.add("skip-animation"),this.components._elements.highlightBox.style.left=this.elems[0].node.offsetLeft-this.options.padding.left,this.components._elements.highlightBox.style.top=this.elems[0].node.offsetTop-this.options.padding.top,this._animateHighlightBox(),this.components._elements.highlightBox.classList.remove("skip-animation")}.bind(this)}},{key:"__scrollMovement",value:function(n,i){var o=this,r=n-this.options.scrolling.timer,a=Math.ceil(s.easeOutQuad(r,this.options.scrolling.position,i-this.options.scrolling.position,this.options.scrolling.speed));t.scrollTo(0,a),r<this.options.scrolling.speed?t.requestAnimationFrame((function(t){o.__scrollMovement(t,i)})):(this.options.scrolling.timer=null,this.options.scrolling.position=Math.min(i,e.documentElement.offsetHeight-t.innerHeight))}}],[{key:"installCustomAction",value:function(){var t=arguments.length>0&&arguments[0]!==n?arguments[0]:{},e=t.key,o=e===n?s.mandatory("Identifier"):e,r=t.event,a=r===n?s.mandatory("Event"):r;i.actions.custom.push({key:o,event:a})}}]),i})();a.actions={baseAttributes:{next:a.prototype.next,prev:a.prototype.prev,close:a.prototype.close},custom:[]},t.Tutorial||(t.Tutorial=a)})(window,document);